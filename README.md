# Health Calculator Microservice with CI/CD Pipeline on Azure

## Project Overview
This project involves the creation of a Python-based microservice that calculates health metrics (BMI and BMR) using a REST API. The application is containerized with Docker, orchestrated using a Makefile, and deployed to Azure App Service using a CI/CD pipeline implemented with GitHub Actions.

---

## Features
- **BMI Calculation**: Calculates Body Mass Index (BMI) using weight (kg) and height (m).
- **BMR Calculation**: Calculates Basal Metabolic Rate (BMR) using weight (kg), height (cm), age, and gender.
- **RESTful API**: Flask-based API with endpoints:
  - `/bmi`: For BMI calculations.
  - `/bmr`: For BMR calculations.
- **Dockerized**: Fully containerized application.
- **CI/CD**: GitHub Actions pipeline for automated testing and deployment.
- **Azure Deployment**: Hosted on Azure App Service.

---

## Prerequisites

### Tools
- Python 3.9+
- [Docker](https://www.docker.com/)
- Git
- [Azure Account](https://azure.microsoft.com/)

---

## Setup Instructions
1. Clone the repository :
```bash
git clone <repository>
cd health-calculator-service
```

2. Initialise the virtual environment :
```bash
make init
```

3. Activate the virtual environment:
```bash
make install
```

## üèó Building and starting up

1. Build the Docker image :
```bash
make build
```

2. Launch the container:
```bash
make run
```

3. Check the status of the container:
```bash
make status
```

## Tests

1. Run the unit tests :
```bash
make test
```

2. Test the API endpoints:
```bash
make test-api
```
## Project Structure
```
health-calculator-service/
‚îú‚îÄ‚îÄ app.py               # Main Flask application
‚îú‚îÄ‚îÄ health_utils.py      # Utility functions for BMI and BMR calculations
‚îú‚îÄ‚îÄ requirements.txt     # Python dependencies
‚îú‚îÄ‚îÄ Dockerfile           # Docker configuration
‚îú‚îÄ‚îÄ Makefile             # Task automation
‚îú‚îÄ‚îÄ test.py              # Unit tests
‚îî‚îÄ‚îÄ .github/workflows/ci-cd.yml  # GitHub Actions pipeline
```

---

## API Endpoints
### 1. `/bmi`
**Method**: POST

**Request Body**:
```json
{
  "height": 1.75,
  "weight": 70
}
```

**Response**:
```json
{
  "bmi": 22.86
}
```

### 2. `/bmr`
**Method**: POST

**Request Body**:
```json
{
  "height": 175,
  "weight": 70,
  "age": 30,
  "gender": "male"
}
```

**Response**:
```json
{
  "bmr": 1666.47
}
```

---

## Makefile Commands
| Command         | Description                       |
|-----------------|-----------------------------------|
| `make init`     | Initiate virtual environnement    |
| `make install`  | Activate virtual environnement    |
| `make build`    | Build the docker image            |
| `make run`      | Launch the container              |
| `make status`   | Check the container status        |
| `make test`     | Execute unit tests                |
| `make test-api` | Execute the application           |
| `make stop `    | Stop the container                |
| `make clean`    | Remove temporary/generated files  |


---
## Azure Deployment 

### Step 1: Connect to Your Web App Service
1. Go to the [Azure portal](https://portal.azure.com).
2. Search for and select **App Services** in the search bar.
3. Click on your Web App Service (e.g., `health-calculator-app`).

### Step 2: Enable the Deployment Center
1. In the left-hand menu, click **Deployment Center**.
2. Under the **Source Control** section, select **GitHub**.
3. Click **Authorize** to connect Azure to your GitHub account (if not already connected).
   - A pop-up window will ask you to authorize Azure to access your GitHub repositories.
4. Configure the following options:
   - **Organization**: Choose your GitHub organization or account.
   - **Repository**: Select the repository containing your application.
   - **Branch**: Select the main branch (e.g., `main`).

### Step 3: Configure Build Settings (Optional)
- **Recommended**: Use GitHub Actions to manage the deployment pipeline.
  - Skip to the next step.
- **Alternative**: Use Azure to build and deploy your application:
  1. Configure runtime settings (e.g., Python version: `3.12`).
  2. Enable the **Use Deployment** option to deploy the code automatically.

### Step 4: Save and Deploy
1. Click **Save** to save your settings.
2. Deployment will start automatically if you have recent commits in your main branch.

### Step 5: Test and Validate
1. Access the URL generated by Azure for your application:
   ```
   https://<your-app-name>.azurewebsites.net
   ```
2. Verify that your API is working by testing the `/bmi` and `/bmr` endpoints.

## GitHub Actions Verification
Ensure that your Azure secrets are correctly configured in your GitHub repository:
1. Go to **Settings > Secrets and Variables > Actions** in GitHub.
2. Add the following secrets:
   - `AZUREAPPSERVICE_CLIENTID`
   - `AZUREAPPSERVICE_TENANTID`
   - `AZUREAPPSERVICE_SUBSCRIPTIONID`

These secrets enable continuous deployment, so any code changes in the main branch will trigger an automatic deployment.


## CI/CD Pipeline
### GitHub Actions Workflow
The CI/CD pipeline automates the following tasks:
1. Checks out the code.
2. Sets up the Python environment.
3. Installs dependencies.
4. Runs unit tests.
5. Builds the Docker image.
6. Deploys the application to Azure.

The configuration is in `.github/workflows/main_health-calculator-application.yml`.


## Known Issues and Improvements
- Additional validations can be added for API inputs.
- Add caching mechanisms for repeated calculations.
- Extend the CI/CD pipeline with additional stages like linting or security scans.

---

## License
This project is licensed under the MIT License. See the LICENSE file for details.

---

## Author
Your Name

For questions or feedback, feel free to contact [your_email@example.com].
